ë¦¬í…œ
retem_
ì˜¨ë¼ì¸

#ã„¹ã„¹ã…œã…œã„´ã„´ ì±„ë„ì˜ ì‹œì‘ì´ì—ìš”. 
ë¦¬í…œ â€” 2025-06-20(ê¸ˆ) ì˜¤í›„ 5:56
ì´ˆë°˜ì— ë§ˆë²•ë´‰ìœ¼ë¡œ ë§ˆë‚˜ ì±„ìš°ë©´ì„œ ëª¹ ì¡ê¸°
ë¦¬í…œ â€” 2025-06-21(í† ) ì˜¤ì „ 4:00
ê·¸ëŸ° ì§€í˜•ì´ peaks ë¼ê³  í•´ì„œ í•œêµ­ì–´ë¡  ë´‰ìš°ë¦¬ë¼ê³  ë²ˆì—­ë˜ì–´ ìˆëŠ” ë°”ì´ì˜´ì¸ë°
ë³´í†µ ì´ëŸ° ë°”ì´ì˜´ì´ ëˆˆì´ ë®í˜€ìˆëŠ” í˜•íƒœê°€ ë§ìŒ

ê·¸ë˜ì„œ ì´ëŸ° ë°”ì´ì˜´ì˜ ê°€ì¥ yê°’ì´ ë†’ì€ ê³³ì—ì„œ íŒŒê³  ë‚´ë ¤ê°€ë©´ ë”¥ ë‹¤í¬ ì§€í˜•(ìŠ¤ì»¬í¬ ì§€í˜•)ì€ ë¬´ì¡°ê±´ ìˆê³ 
ê³ ëŒ€ ë„ì‹œê°€ ìˆì„ í™•ë¥ ì´ ë†’ìŒ
ë¦¬í…œ â€” 2025-06-21(í† ) ì˜¤í›„ 6:30
1054 11 -1156 ë§ˆì„ê°€ë£¨
ë¦¬í…œ â€” 2025-06-22(ì¼) ì˜¤ì „ 1:27
https://docs.google.com/spreadsheets/d/1i_qiR_t7fQSRLDteCIxKcmHXtfowYshvuXPmovTEpwU/edit?gid=0#gid=0
ë¦¬í…œ â€” 2025-06-26(ëª©) ì˜¤í›„ 7:42
ëˆˆ ë®ì¸ ë¹„íƒˆ, 
ë¾°ì¡±í•œ ë´‰ìš°ë¦¬ (Jagged Peak)

ì–¼ì–´ë¶™ì€ ë´‰ìš°ë¦¬ (Frozen Peak)

ëŒ ë´‰ìš°ë¦¬,
ë²šë‚˜ë¬´ ìˆ² (heey Grove)

ëª©ì´ˆì§€ (Meadow)

ì‚°ë¦¼ (Grove)
í†µ ê°€ëŠ¥í•œì§€
ë¦¬í…œ â€” 2025-06-27(ê¸ˆ) ì˜¤ì „ 2:39
/ì“°ë˜ê¸°í†µ
ìˆìŒ
ë¦¬í…œ â€” 2025-06-28(í† ) ì˜¤í›„ 5:31
ë†ì‘ì§€ ëª‡xëª‡ë¦°ì§€ í™•ì¸
ë¦¬í…œ â€” 2025-06-29(ì¼) ì˜¤í›„ 11:27
ì˜µì‹œë””ì–¸ ì°¨ì›ì„
ëˆ ë˜ì „ìœ¼ë¡œ í•¨
ë¦¬í…œ â€” 2025-06-30(ì›”) ì˜¤í›„ 10:19
https://cafe.naver.com/bjcrocodile/3631845?tc=shared_link
ë¦¬í…œ â€” 2025-06-30(ì›”) ì˜¤í›„ 11:55
í¬ê·€ì— íƒ±ì»¤ì— ì¢‹ì€ë£¬ ë§ìŒ
ë¦¬í…œ â€” 2025-07-04(ê¸ˆ) ì˜¤í›„ 7:11
í¬ê·€ë£¬ ê°ì • 5000
ë¦¬í…œ â€” 2025-07-05(í† ) ì˜¤í›„ 8:49
ëª‡ëª‡npc ìœ„ì¹˜ ë³€ê²½
íƒ€ë£¬ì— ì •ë³´ìƒì¸ìˆìŒ
ë¦¬í…œ â€” 2025-07-06(ì¼) ì˜¤í›„ 7:27
ìš”ë²ˆ íšŒì°¨ 2ì‹œê°„(ì´ë²¤íŠ¸ ì œì™¸)
í›„ì›ì—°ë™ ë‹¤ìŒì£¼ì— ë¬´ì¡°ê±´ ì¶”ê°€ ì˜ˆì •(ì•…ì–´ë‹˜ì—ê²Œ ë§ì”€í•¨) ë„¤ë” ë„êµ¬1%, ìˆ˜ì„  0.5%, 05% ì•„ë˜ëŠ” ì„œë²„ ì „ì²´ ì•ŒëŒì´ ëœ¸
íšŒê·€ë¬´ê¸°(ë£¬ìŠ¬ë¡¯ 4ê°œ), ê°‘ì˜·(ì¤‘ìš”í• ë“¯?)ê°‘ì˜· ë‹¤ ëª»êµ¬í•˜ë©´ í•œë°©ë‚ ìˆ˜ë„ í’€ì…‹ë§ì¶”ë©´ ì´ê¹€(ì˜ˆìƒ)
ì•„ì´ìŠ¤ë³¼ ap 210% í•„ìš”ë§ˆë‚˜ 110
pvpê³„ìˆ˜ìƒê¹€ ì•ˆì ¹í˜€ ìˆìœ¼ë©´ ê¸°ë³¸ 0.5 
15ì´ˆë™ì•ˆ ì „íˆ¬ ì•ˆí•˜ë©´ ì‹ ì† 2 ì œê³µ ê³µê²©ë‹¹í•˜ê±°ë‚˜ í•˜ë©´ ë°”ë¡œ í’€ë¦¼
ë§ˆë²•ë£¬(ì‹ ì˜ë£¬?) ì´ë²ˆ íšŒì°¨ ê°€ì¹˜X ë‚˜ì¤‘ì— ê°€ì¹˜ ìˆìŒ
ê¸¸ë“œ ì°½ê³  ë‹¤ìŒ ê¸ˆì•¡ ë°±ë§Œì› í•œì¤„ì”© ëŠ˜ì–´ë‚¨
ì•¼ìƒ ë“¤ì–´ê°€ë©´ ë°”ë¡œ ì•ì— ì—ë©”ë„ë“œ ìˆì„ë§Œí•œ ì§€ì—­ìˆìŒ ê°€ë³´ê¸°
ìš©ë³‘ ë‹¤ìŒì—ëŠ” í• ìˆ˜ ìˆë„ë¡ ë…¸ë ¥
ë¦¬í…œ â€” 2025-07-07(ì›”) ì˜¤í›„ 8:18
ì•„í‹°í™íŠ¸ëŠ” ë¡¤ì—ì„œ ë”°ì˜¨ê²Œ ìˆìŒ
ë¦¬í…œ â€” 2025-07-25(ê¸ˆ) ì˜¤í›„ 11:22
https://cfx3awqnknjftoavdph9cd.streamlit.app/#56edc69b
ë¦¬í…œ â€” 2025-07-27(ì¼) ì˜¤í›„ 7:20
https://retemrune1.streamlit.app/
Streamlit
Streamlit
This app was built in Streamlit! Check it out and visit https://streamlit.io for more awesome community apps. ğŸˆ
Streamlit
ë¦¬í…œ â€” 2025-07-27(ì¼) ì˜¤í›„ 9:39
ì¢Œí‘œ ì…ë ¥í•˜ë©´ ì–´ë”” í…”í¬ê°€ ê°€ê¹Œìš´ì§€
ë¦¬í…œ â€” 2025-07-28(ì›”) ì˜¤ì „ 3:03
ìƒˆë¡œìš´ ëª©ë¡ ë§Œë“¤ì–´ì„œ ì¬ë£Œ í´ë¦­í•˜ë©´ ì–´ëŠ ë³´ìŠ¤ì—ì„œ ë‚˜ì˜¤ëŠ”ì§€
ê°€ìƒ ì§€ë„ ë¹„ìŠ·í•˜ê²Œ ë§Œë“¤ê¸°
ë¦¬í…œ â€” 2025-07-31(ëª©) ì˜¤í›„ 5:58
{"name": "", "location": [, , ], "region": "", "reward": "", "notes": ""},
ë¦¬í…œ â€” 2025-08-03(ì¼) ì˜¤í›„ 7:37
import streamlit as st
import math
import plotly.express as px
import pandas as pd
import os
í™•ì¥
message.txt
18KB
ë¦¬í…œ â€” 2025-08-03(ì¼) ì˜¤í›„ 7:50
# ------------------ ê±°ë¦¬ ê³„ì‚° ------------------
def get_nearest_teleport(location, teleports):
    def euclidean(a, b):
        return math.sqrt(sum((x - y) ** 2 for x, y in zip(a, b)))
    nearest = min(teleports, key=lambda t: euclidean(t["location"], location))
    return nearest, round(euclidean(nearest["location"], location))
í™•ì¥
message.txt
11KB
ë¦¬í…œ â€” 2025-08-04(ì›”) ì˜¤ì „ 2:25
ì „ìŸ ì§€ë„ ë§Œë“¤ê¸°
ë¦¬í…œ â€” 2025-08-05(í™”) ì˜¤ì „ 11:57
1
ë¦¬í…œ â€” 2025-08-08(ê¸ˆ) ì˜¤í›„ 10:47
ë°©í”Œê°€ëŠ¥
ë¦¬í…œ â€” ì˜¤í›„ 8:59
import streamlit as st
import math
import pandas as pd
import plotly.graph_objects as go



# ------------------ ë°ì´í„° ì •ì˜ ------------------
data = {
    "dungeons": [
        {"name": "ìˆ˜í˜¸ê¸°ì‚¬ í´ë¡œìŠ¤", "location": [1370, 46, -1030], "region": "", "reward": ""},
        {"name": "ìŠ¬ë¼ì„ í‚¹", "location": [1214, 10, -600], "region": "", "reward": ""},
        {"name": "ë³€ì´ëœ ì–¸ë°ë“œ", "location": [1702, 10, -870], "region": "ì˜¤ì—¼ëœ ë•…", "reward": ""},
        {"name": "ìŠ¬ë¼ì„ ê¸°ì‚¬", "location": [1632, 10, -690], "region": "ëˆì ì´ëŠ” ë•…", "reward": ""},
        {"name": "ë€", "location": [1154, 9, -1340], "region": "", "reward": "2000G"},
        {"name": "ë³€ì´ëœ ìŠ¤ì¼ˆë ˆí†¤", "location": [1290, 22, -1380], "region": "", "reward": "2000G"},
        {"name": "ë§ê´„ëŸ‰ì´ ë§ˆë²•ì‚¬ ë°ì´ë¹„", "location": [1050, 10, -1155], "region": "", "reward": ""},
        {"name": "ì „ì‚¬ ë¸Œë£¨ìŠ¤", "location": [1110, 75, -1214], "region": "ë‚¡ì€ ê²€ì˜ ì€ì‹ ì²˜", "reward": "3000G"},
        {"name": "íœë¦¬ë¥´", "location": [1180, 75, -1130], "region": "ê³ ë…í•œ ëŠ‘ëŒ€ì˜ ìš”ëŒ", "reward": "5000G, ì˜í—˜í•œ í˜ì´ ê¹ƒë“  ëŠ‘ëŒ€ ì´ë¹¨, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ìŠ¬ë¼ì„ í€¸", "location": [1355, 70, -1114], "region": "ë¶€íŒ¨ì˜ ëª¨ì²´", "reward": "3000G, ìŠ¬ë¼ì„ í€¸ì˜ í•µ"},
        {"name": "í¬ë ˆìŠ¤íŠ¸ ê³¨ë ˜", "location": [1100, 78, -1100], "region": "ëŒ€ìì—°ì˜ ìˆ˜í˜¸ì „", "reward": "3000G, ê³¨ë ˜ì˜ í•µ"},
        {"name": "í‘ëŸ‰", "location": [1630, 81, -690], "region": "ì¿ë¹› ì‚¬ëƒ¥ê¾¼ì˜ ì˜ì—­", "reward": "3000G,  ê²€ì€ ì´ë¦¬ ê°€ì£½"},
        {"name": "ê³ ë¸”ë¦° ë¼ì´ë” & ì™€ì¼ë“œ ë³´ì–´ í‚¹", "location": [1660, 69, -1200], "region": "ì•¼ë§Œì˜ êµ°ì²´", "reward": "3000G, ê³ ë¸”ë¦°ë¼ì´ë”ì˜ ê¹ƒë°œ"},
        {"name": "ì•¼ë§Œ ì „ì‚¬ í—¬í„´", "location": [1532, 16, -790], "region": "ì•¼ë§Œì˜ ê²©ì „ì§€", "reward": "3000G, ì•¼ë§Œì „ì‚¬ ë„ë¼"},
        {"name": "ì¹¨ë¬µì˜ ê²€ë¬´ í‚¤ì—ë¦°", "location": [114, 67, 611], "region": "ì €ë¬´ëŠ” ì¹¼ë‚ ì˜ ê¸¸", "reward": "5000G, ê²€ì˜ ì¸ì‹ì²˜, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ë´‰ì¸ëœ ë¬¸ì¥ ê·¸ë¦°íë¦„", "location": [-472, 71, 502], "region": "ë´‰ì¸ëœ ì„±ì†Œ", "reward": "5000G, í˜ë°ë„íŠ¸ì˜ ë¬¸ì¥, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ì‚¬ìí˜¼ì¢…", "location": [-160, 69, 74], "region": "í˜¼ëˆì˜ ë¯¸ê¶", "reward": "5000G, ê±°ì¹œ ì‚¬ìê°ˆê¸°, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ìœŒì‹œì˜ íŒŒê´´ì ìš¸ë¼í”„", "location": [4, 70, 23], "region": "í”¼ì—„ë‹‰ ë¶ˆëª¨ì§€", "reward": "5000G, ì„ ë´‰ì¥ì˜ í—ˆë¦¬ë , ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ì² í˜ˆì˜ ì‹¬íŒì íƒ€ë¥´ì½˜", "location": [197, 73, 33], "region": "ì‹¬íŒì˜ ë³´ë£¨", "reward": "5500G, ë§ì¹˜ìë£¨, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ì•…ë§ˆ ê¸°ì‚¬ ë² ì•„ë¥´ë…¼", "location": [-654, 69, 217], "region": "íŒŒë©¸ì˜ ì„ ë´‰ëŒ€", "reward": "5500G, ë²ˆê°œì¡°ê°, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ì‹¬ì—°ì˜ ê¸°ì‚¬ ì•„ë¥´ë°˜ë¸", "location": [-335, 72, -65], "region": "ë§ê°ì˜ ì„±ì±„", "reward": "5500G, ì‹¬ì—°ì„ ë¹„ì¶”ëŠ” ë“±ë¶ˆ, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "íƒ€ë½í•œ ì„±ì§ì ì‹œë„¤ë¦¬ì•„(ì‹¬ì—°ì„ ê±·ëŠ”ì)", "location": [-117, 67, 978], "region": "ê·¸ë¦¼ì ì˜ˆë°°ë‹¹", "reward": "6000G, ë¶€ëŸ¬ì§„ ë‚«, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ê½ƒì˜ ì™ˆì¸  í”Œë¢°ë¦¬ìŠ¤", "location": [-340, 70, 950], "region": "ê°€ì‹œ ì¥ë¯¸ ì •ì›", "reward": "6000G, ëì—†ëŠ” ê°œí™”, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼", "notes": "yì¢Œí‘œ ì„ì‹œ"},
        {"name": "ë¹„ì—´í•œ ê·¸ë¦¼ì ì…€ë Œ", "location": [556, 72, 113], "region": "ì¹¨ë¬µì˜ íšŒë‘", "reward": "6000G, ëª©ê³µ ë„êµ¬, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼", "notes": ""},
        {"name": "í­í’ì˜ ì°½ ì˜¤ë‹‰ìŠ¤", "location": [336, 70, 248], "region": "ê¿°ëš«ëŠ” í­íì˜ ëˆˆ", "reward": "5000G, êº½ì—¬ë²„ë¦° ì°½, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼", "notes": ""},
        {"name": "ì €ì£¼ ì„¤ê³„ì ëª¨ë¥´ëª¨íŠ¸", "location": [-226, 72, 369], "region": "ê³µí—ˆì˜ ì „ë‹¹", "reward": "5000G, ê³µí—ˆí•œ ìš´ì„, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼", "notes": ""},
        {"name": "í‚¤ë©”ë¼ì›Œë¦¬ì–´", "location": [-158, 73, 33], "region": "í˜¼ë™ì˜ ë¯¸ê¶", "reward": "", "notes": "ì‚¬ìí˜¼ì¢…ì—ì„œ ë³€ê²½ëœ ë³´ìŠ¤"},
        {"name": "", "location": [199 , 70, 73], "region": "íŒŒí¸ì˜ ë³´ë£¨ ë˜ì „", "reward": "", "notes": ""},
        {"name": "ìƒˆë²½ì„ ê°€ë¥´ëŠ” ì ì—˜ë¦¬ë‚˜", "location": [903, 68, 381], "region": "ì—¬ëª…ì˜ ê²½ê³„ ë˜ì „", "reward": "", "notes": ""},
    ],
    "npcs": [
        {"name": "ì •ìˆ˜ ìƒì¸", "location": [-4077, 72, 78], "notes": ""},
        {"name": "ì•„ì´ë²¨, íŒŒë¥´í‹°ì˜¤", "location": [2550, 86, -1011], "notes": ""},
        {"name": "ìƒ¤ë²¨", "location": [2774, 106, -940], "notes": ""},
        {"name": "ì¡í™” ìƒì  ê¸€ë¦¬ì•„", "location": [2660, 72, -756], "notes": ""},
        {"name": "ë†ì‘ë¬¼ ìƒì¸", "location": [2699, 84, -1013]},
        {"name": "ì¡í™” ìƒì¸", "location": [2754, 72, -1001]},
        {"name": "ê´‘ë¬¼ ìƒì¸", "location": [2741, 69, -1001]},
        {"name": "ì •ë³´ ìƒì¸", "location": [2755, 73, -1015]},
        {"name": "ë‚šì‹œ ìƒì¸", "location": [2757, 71, -986]},
        {"name": "ì—°ê¸ˆ npc", "location": [2932, 87, -957], "notes": "ë‹ë€"},
        {"name": "ìš°í¸ npc", "location": [2667, 103, -1071], "notes": "ë©”ì´"},
        {"name": "ê¸°ë¶€ npc", "location": [2816, 129, -1355], "notes": "ì„¸ë¥´ì¹´"},
        {"name": "ì œì‘ npc", "location": [2625, 122, -1319], "notes": "ë“œë°˜"},
        {"name": "ê°•í™” npc", "location": [2625, 122, -1319], "notes": "ë¸Œë Œ"},
        {"name": "ë£¬ê°ì • npc", "location": [2861, 94, -1070], "notes": "íŒŒì´ë Œ"},
        {"name": "ì¡í™” ìƒì¸", "location": [1312, 14, -860], "notes": "íƒ€ë£¬"}
    ],
    "teleports": [
        {"name": "ë£¨ë„¤ì•„ ê¸°ì‚¬ë‹¨ ì• ê¸¸ëª©", "location": [2661, 122, -1330], "region_type": "ë§ˆì„"},
        {"name": "ë£¨ë„¤ì•„ ì¤‘ì•™ ë¶„ìˆ˜", "location": [2900, 84, -940], "region_type": "ë§ˆì„"},
        {"name": "ë£¨ë„¤ì•„ ìƒì ê°€", "location": [2760, 72, -1062], "region_type": "ë§ˆì„"},
        {"name": "ë£¨ë„¤ì•„ ë§ˆë²•ì˜ ì„¬", "location": [2903, 84, -943], "region_type": "ë§ˆì„"},
        {"name": "ë£¨ë„¤ì•„ ëŒ€í˜•ë¶„ìˆ˜", "location": [2660, 104, -1084], "region_type": "ë§ˆì„"},
        {"name": "í‚¤ë‚˜ë¥´ ë§ˆì„ ì¤‘ì•™", "location": [1290, 14, -874], "region_type": "ë˜ì „"},
        {"name": "íƒ€ë£¬ í™©êµ­ì§€ëŒ€ ë‚¨ë¶€", "location": [1446, 11, -623], "region_type": "ë˜ì „"},
        {"name": "íƒ€ë£¬ í™©êµ­ì§€ëŒ€ ë¶ìª½", "location": [1178, 9, -1245], "region_type": "ë˜ì „"},
        {"name": "ê¸€ë¦¬ì•¼ ë§ˆì„ ì¤‘ì•™", "location": [20, 90, 332], "region_type": "ë˜ì „"},
        {"name": "ê¸€ë¦¬ì•¼ ë§ˆì„ ë™ìª½", "location": [428, 71, 395], "region_type": "ë˜ì „"},
        {"name": "ê¸€ë¦¬ì•¼ ë§ˆì„ ë‚¨ìª½", "location": [140, 70, 774], "region_type": "ë˜ì „"},
        {"name": "ê¸€ë¦¬ì•¼ ë§ˆì„ ë¶ë™ìª½", "location": [246, 68, 115], "region_type": "ë˜ì „"},
        {"name": "ê¸€ë¦¬ì•¼ ë§ˆì„ ë¶ì„œìª½", "location": [-235, 71, 29], "region_type": "ë˜ì „"}
    ],
    "Dungeon Boys": [
        {"name": "ì„ì‹œ ì£¼ì„±", "location": [111, 111, 111]},
    ],
    "Wasobeso": [
        {"name": "ì„ì‹œ ì£¼ì„±", "location": [222, 222, 222]},
    ],
    "Tangled Dahye": [
        {"name": "ì„ì‹œ ì£¼ì„±", "location": [333, 333, 333]},
    ]
}


# ------------------ ê±°ë¦¬ ê³„ì‚° ------------------
def get_nearest_teleport(location, teleports):
    def euclidean(a, b):
        return math.sqrt(sum((x - y) ** 2 for x, y in zip(a, b)))
    nearest = min(teleports, key=lambda t: euclidean(t["location"], location))
    return nearest, round(euclidean(nearest["location"], location))

# ------------------ ê²€ìƒ‰ ê¸°ëŠ¥ ------------------
def search_data(keyword, data):
    keyword = keyword.strip().lower()
    results = {"ë˜ì „": [], "NPC": [], "í…”ë ˆí¬íŠ¸": []}

    for npc in data["npcs"]:
        npc_region = npc.get("region", "")
        if keyword in npc["name"].lower() or keyword in npc.get("notes", "").lower() or keyword in npc_region.lower() or keyword == "":
... (281ì¤„ ë‚¨ìŒ)
ì ‘ê¸°
message.txt
22KB
ï»¿
import streamlit as st
import math
import pandas as pd
import plotly.graph_objects as go



# ------------------ ë°ì´í„° ì •ì˜ ------------------
data = {
    "dungeons": [
        {"name": "ìˆ˜í˜¸ê¸°ì‚¬ í´ë¡œìŠ¤", "location": [1370, 46, -1030], "region": "", "reward": ""},
        {"name": "ìŠ¬ë¼ì„ í‚¹", "location": [1214, 10, -600], "region": "", "reward": ""},
        {"name": "ë³€ì´ëœ ì–¸ë°ë“œ", "location": [1702, 10, -870], "region": "ì˜¤ì—¼ëœ ë•…", "reward": ""},
        {"name": "ìŠ¬ë¼ì„ ê¸°ì‚¬", "location": [1632, 10, -690], "region": "ëˆì ì´ëŠ” ë•…", "reward": ""},
        {"name": "ë€", "location": [1154, 9, -1340], "region": "", "reward": "2000G"},
        {"name": "ë³€ì´ëœ ìŠ¤ì¼ˆë ˆí†¤", "location": [1290, 22, -1380], "region": "", "reward": "2000G"},
        {"name": "ë§ê´„ëŸ‰ì´ ë§ˆë²•ì‚¬ ë°ì´ë¹„", "location": [1050, 10, -1155], "region": "", "reward": ""},
        {"name": "ì „ì‚¬ ë¸Œë£¨ìŠ¤", "location": [1110, 75, -1214], "region": "ë‚¡ì€ ê²€ì˜ ì€ì‹ ì²˜", "reward": "3000G"},
        {"name": "íœë¦¬ë¥´", "location": [1180, 75, -1130], "region": "ê³ ë…í•œ ëŠ‘ëŒ€ì˜ ìš”ëŒ", "reward": "5000G, ì˜í—˜í•œ í˜ì´ ê¹ƒë“  ëŠ‘ëŒ€ ì´ë¹¨, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ìŠ¬ë¼ì„ í€¸", "location": [1355, 70, -1114], "region": "ë¶€íŒ¨ì˜ ëª¨ì²´", "reward": "3000G, ìŠ¬ë¼ì„ í€¸ì˜ í•µ"},
        {"name": "í¬ë ˆìŠ¤íŠ¸ ê³¨ë ˜", "location": [1100, 78, -1100], "region": "ëŒ€ìì—°ì˜ ìˆ˜í˜¸ì „", "reward": "3000G, ê³¨ë ˜ì˜ í•µ"},
        {"name": "í‘ëŸ‰", "location": [1630, 81, -690], "region": "ì¿ë¹› ì‚¬ëƒ¥ê¾¼ì˜ ì˜ì—­", "reward": "3000G,  ê²€ì€ ì´ë¦¬ ê°€ì£½"},
        {"name": "ê³ ë¸”ë¦° ë¼ì´ë” & ì™€ì¼ë“œ ë³´ì–´ í‚¹", "location": [1660, 69, -1200], "region": "ì•¼ë§Œì˜ êµ°ì²´", "reward": "3000G, ê³ ë¸”ë¦°ë¼ì´ë”ì˜ ê¹ƒë°œ"},
        {"name": "ì•¼ë§Œ ì „ì‚¬ í—¬í„´", "location": [1532, 16, -790], "region": "ì•¼ë§Œì˜ ê²©ì „ì§€", "reward": "3000G, ì•¼ë§Œì „ì‚¬ ë„ë¼"},
        {"name": "ì¹¨ë¬µì˜ ê²€ë¬´ í‚¤ì—ë¦°", "location": [114, 67, 611], "region": "ì €ë¬´ëŠ” ì¹¼ë‚ ì˜ ê¸¸", "reward": "5000G, ê²€ì˜ ì¸ì‹ì²˜, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ë´‰ì¸ëœ ë¬¸ì¥ ê·¸ë¦°íë¦„", "location": [-472, 71, 502], "region": "ë´‰ì¸ëœ ì„±ì†Œ", "reward": "5000G, í˜ë°ë„íŠ¸ì˜ ë¬¸ì¥, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ì‚¬ìí˜¼ì¢…", "location": [-160, 69, 74], "region": "í˜¼ëˆì˜ ë¯¸ê¶", "reward": "5000G, ê±°ì¹œ ì‚¬ìê°ˆê¸°, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ìœŒì‹œì˜ íŒŒê´´ì ìš¸ë¼í”„", "location": [4, 70, 23], "region": "í”¼ì—„ë‹‰ ë¶ˆëª¨ì§€", "reward": "5000G, ì„ ë´‰ì¥ì˜ í—ˆë¦¬ë , ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ì² í˜ˆì˜ ì‹¬íŒì íƒ€ë¥´ì½˜", "location": [197, 73, 33], "region": "ì‹¬íŒì˜ ë³´ë£¨", "reward": "5500G, ë§ì¹˜ìë£¨, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ì•…ë§ˆ ê¸°ì‚¬ ë² ì•„ë¥´ë…¼", "location": [-654, 69, 217], "region": "íŒŒë©¸ì˜ ì„ ë´‰ëŒ€", "reward": "5500G, ë²ˆê°œì¡°ê°, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ì‹¬ì—°ì˜ ê¸°ì‚¬ ì•„ë¥´ë°˜ë¸", "location": [-335, 72, -65], "region": "ë§ê°ì˜ ì„±ì±„", "reward": "5500G, ì‹¬ì—°ì„ ë¹„ì¶”ëŠ” ë“±ë¶ˆ, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "íƒ€ë½í•œ ì„±ì§ì ì‹œë„¤ë¦¬ì•„(ì‹¬ì—°ì„ ê±·ëŠ”ì)", "location": [-117, 67, 978], "region": "ê·¸ë¦¼ì ì˜ˆë°°ë‹¹", "reward": "6000G, ë¶€ëŸ¬ì§„ ë‚«, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼"},
        {"name": "ê½ƒì˜ ì™ˆì¸  í”Œë¢°ë¦¬ìŠ¤", "location": [-340, 70, 950], "region": "ê°€ì‹œ ì¥ë¯¸ ì •ì›", "reward": "6000G, ëì—†ëŠ” ê°œí™”, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼", "notes": "yì¢Œí‘œ ì„ì‹œ"},
        {"name": "ë¹„ì—´í•œ ê·¸ë¦¼ì ì…€ë Œ", "location": [556, 72, 113], "region": "ì¹¨ë¬µì˜ íšŒë‘", "reward": "6000G, ëª©ê³µ ë„êµ¬, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼", "notes": ""},
        {"name": "í­í’ì˜ ì°½ ì˜¤ë‹‰ìŠ¤", "location": [336, 70, 248], "region": "ê¿°ëš«ëŠ” í­íì˜ ëˆˆ", "reward": "5000G, êº½ì—¬ë²„ë¦° ì°½, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼", "notes": ""},
        {"name": "ì €ì£¼ ì„¤ê³„ì ëª¨ë¥´ëª¨íŠ¸", "location": [-226, 72, 369], "region": "ê³µí—ˆì˜ ì „ë‹¹", "reward": "5000G, ê³µí—ˆí•œ ìš´ì„, ë¯¸ì•½í•œ í˜ì´ ë‹´ê¸´ ì˜í˜¼", "notes": ""},
        {"name": "í‚¤ë©”ë¼ì›Œë¦¬ì–´", "location": [-158, 73, 33], "region": "í˜¼ë™ì˜ ë¯¸ê¶", "reward": "", "notes": "ì‚¬ìí˜¼ì¢…ì—ì„œ ë³€ê²½ëœ ë³´ìŠ¤"},
        {"name": "", "location": [199 , 70, 73], "region": "íŒŒí¸ì˜ ë³´ë£¨ ë˜ì „", "reward": "", "notes": ""},
        {"name": "ìƒˆë²½ì„ ê°€ë¥´ëŠ” ì ì—˜ë¦¬ë‚˜", "location": [903, 68, 381], "region": "ì—¬ëª…ì˜ ê²½ê³„ ë˜ì „", "reward": "", "notes": ""},
    ],
    "npcs": [
        {"name": "ì •ìˆ˜ ìƒì¸", "location": [-4077, 72, 78], "notes": ""},
        {"name": "ì•„ì´ë²¨, íŒŒë¥´í‹°ì˜¤", "location": [2550, 86, -1011], "notes": ""},
        {"name": "ìƒ¤ë²¨", "location": [2774, 106, -940], "notes": ""},
        {"name": "ì¡í™” ìƒì  ê¸€ë¦¬ì•„", "location": [2660, 72, -756], "notes": ""},
        {"name": "ë†ì‘ë¬¼ ìƒì¸", "location": [2699, 84, -1013]},
        {"name": "ì¡í™” ìƒì¸", "location": [2754, 72, -1001]},
        {"name": "ê´‘ë¬¼ ìƒì¸", "location": [2741, 69, -1001]},
        {"name": "ì •ë³´ ìƒì¸", "location": [2755, 73, -1015]},
        {"name": "ë‚šì‹œ ìƒì¸", "location": [2757, 71, -986]},
        {"name": "ì—°ê¸ˆ npc", "location": [2932, 87, -957], "notes": "ë‹ë€"},
        {"name": "ìš°í¸ npc", "location": [2667, 103, -1071], "notes": "ë©”ì´"},
        {"name": "ê¸°ë¶€ npc", "location": [2816, 129, -1355], "notes": "ì„¸ë¥´ì¹´"},
        {"name": "ì œì‘ npc", "location": [2625, 122, -1319], "notes": "ë“œë°˜"},
        {"name": "ê°•í™” npc", "location": [2625, 122, -1319], "notes": "ë¸Œë Œ"},
        {"name": "ë£¬ê°ì • npc", "location": [2861, 94, -1070], "notes": "íŒŒì´ë Œ"},
        {"name": "ì¡í™” ìƒì¸", "location": [1312, 14, -860], "notes": "íƒ€ë£¬"}
    ],
    "teleports": [
        {"name": "ë£¨ë„¤ì•„ ê¸°ì‚¬ë‹¨ ì• ê¸¸ëª©", "location": [2661, 122, -1330], "region_type": "ë§ˆì„"},
        {"name": "ë£¨ë„¤ì•„ ì¤‘ì•™ ë¶„ìˆ˜", "location": [2900, 84, -940], "region_type": "ë§ˆì„"},
        {"name": "ë£¨ë„¤ì•„ ìƒì ê°€", "location": [2760, 72, -1062], "region_type": "ë§ˆì„"},
        {"name": "ë£¨ë„¤ì•„ ë§ˆë²•ì˜ ì„¬", "location": [2903, 84, -943], "region_type": "ë§ˆì„"},
        {"name": "ë£¨ë„¤ì•„ ëŒ€í˜•ë¶„ìˆ˜", "location": [2660, 104, -1084], "region_type": "ë§ˆì„"},
        {"name": "í‚¤ë‚˜ë¥´ ë§ˆì„ ì¤‘ì•™", "location": [1290, 14, -874], "region_type": "ë˜ì „"},
        {"name": "íƒ€ë£¬ í™©êµ­ì§€ëŒ€ ë‚¨ë¶€", "location": [1446, 11, -623], "region_type": "ë˜ì „"},
        {"name": "íƒ€ë£¬ í™©êµ­ì§€ëŒ€ ë¶ìª½", "location": [1178, 9, -1245], "region_type": "ë˜ì „"},
        {"name": "ê¸€ë¦¬ì•¼ ë§ˆì„ ì¤‘ì•™", "location": [20, 90, 332], "region_type": "ë˜ì „"},
        {"name": "ê¸€ë¦¬ì•¼ ë§ˆì„ ë™ìª½", "location": [428, 71, 395], "region_type": "ë˜ì „"},
        {"name": "ê¸€ë¦¬ì•¼ ë§ˆì„ ë‚¨ìª½", "location": [140, 70, 774], "region_type": "ë˜ì „"},
        {"name": "ê¸€ë¦¬ì•¼ ë§ˆì„ ë¶ë™ìª½", "location": [246, 68, 115], "region_type": "ë˜ì „"},
        {"name": "ê¸€ë¦¬ì•¼ ë§ˆì„ ë¶ì„œìª½", "location": [-235, 71, 29], "region_type": "ë˜ì „"}
    ],
    "Dungeon Boys": [
        {"name": "ì„ì‹œ ì£¼ì„±", "location": [111, 111, 111]},
    ],
    "Wasobeso": [
        {"name": "ì„ì‹œ ì£¼ì„±", "location": [222, 222, 222]},
    ],
    "Tangled Dahye": [
        {"name": "ì„ì‹œ ì£¼ì„±", "location": [333, 333, 333]},
    ]
}


# ------------------ ê±°ë¦¬ ê³„ì‚° ------------------
def get_nearest_teleport(location, teleports):
    def euclidean(a, b):
        return math.sqrt(sum((x - y) ** 2 for x, y in zip(a, b)))
    nearest = min(teleports, key=lambda t: euclidean(t["location"], location))
    return nearest, round(euclidean(nearest["location"], location))

# ------------------ ê²€ìƒ‰ ê¸°ëŠ¥ ------------------
def search_data(keyword, data):
    keyword = keyword.strip().lower()
    results = {"ë˜ì „": [], "NPC": [], "í…”ë ˆí¬íŠ¸": []}

    for npc in data["npcs"]:
        npc_region = npc.get("region", "")
        if keyword in npc["name"].lower() or keyword in npc.get("notes", "").lower() or keyword in npc_region.lower() or keyword == "":
            nearest, dist = get_nearest_teleport(npc["location"], data["teleports"])
            results["NPC"].append({**npc, "type": "NPC", "nearest_tp": nearest, "dist": dist})

    for d in data["dungeons"]:
        if keyword in d["name"].lower() or keyword in d["region"].lower() or keyword in d["reward"].lower() or keyword == "":
            nearest, dist = get_nearest_teleport(d["location"], data["teleports"])
            results["ë˜ì „"].append({**d, "type": "ë˜ì „", "nearest_tp": nearest, "dist": dist})

    for tp in data["teleports"]:
        if keyword in tp["name"].lower() or keyword in tp.get("region_type", "").lower() or keyword == "":
            results["í…”ë ˆí¬íŠ¸"].append({**tp, "type": "í…”ë ˆí¬íŠ¸"})

    return results

# ------------------ ì§€ë„ ê¸°ëŠ¥ ------------------
def plot_virtual_map_interactive(data, mode="normal"):
    fig = go.Figure()

    if mode == "normal":
        show_dungeon = st.sidebar.checkbox("ë˜ì „ í‘œì‹œ", value=True)
        show_npc = st.sidebar.checkbox("NPC í‘œì‹œ", value=True)
        show_tp = st.sidebar.checkbox("í…”ë ˆí¬íŠ¸ í‘œì‹œ", value=True)

        if show_dungeon:
            dungeon_names = [d["name"] for d in data["dungeons"]]
            selected_dungeons = []
            with st.sidebar.expander("ë˜ì „ ëª©ë¡", expanded=False):
                toggle_dungeon_names = st.checkbox("ë˜ì „ ì´ë¦„ ì „ì²´ í‘œì‹œ ON/OFF", value=True, key="toggle_dungeon_names")
                for i, name in enumerate(dungeon_names):
                    checked = st.checkbox(f"{name}", key=f"dungeon_{i}_{name}", value=toggle_dungeon_names)
                    if checked:
                        selected_dungeons.append(name)

            df_dungeon = pd.DataFrame([
                {"ì´ë¦„": d["name"], "X": d["location"][0], "Y": d["location"][1], "Z": d["location"][2],
                 "ì§€ì—­": d["region"], "ë³´ìƒ": d["reward"]}
                for d in data["dungeons"]
            ])
            fig.add_trace(go.Scatter(
                x=df_dungeon["X"], y=df_dungeon["Z"], mode="markers+text", name="ë˜ì „",
                marker=dict(color="red", size=8),
                text=df_dungeon["ì´ë¦„"].where(df_dungeon["ì´ë¦„"].isin(selected_dungeons), ""),
                textposition="top center",
                customdata=df_dungeon[["X", "Y", "Z", "ì´ë¦„", "ì§€ì—­", "ë³´ìƒ"]],
                hovertemplate="X=%{customdata[0]}<br>Y=%{customdata[1]}<br>Z=%{customdata[2]}<br>"
                              "ì´ë¦„=%{customdata[3]}<br>ì§€ì—­=%{customdata[4]}<br>ë³´ìƒ=%{customdata[5]}"
            ))

        if show_npc:
            npc_names = [n["name"] for n in data["npcs"]]
            selected_npcs = []
            with st.sidebar.expander("NPC ëª©ë¡", expanded=False):
                toggle_npc_names = st.checkbox("NPC ì´ë¦„ ì „ì²´ í‘œì‹œ ON/OFF", value=True, key="toggle_npc_names")
                for i, name in enumerate(npc_names):
                    checked = st.checkbox(f"{name}", key=f"npc_{i}_{name}", value=toggle_npc_names)
                    if checked:
                        selected_npcs.append(name)

            df_npc = pd.DataFrame([
                {"ì´ë¦„": n["name"], "X": n["location"][0], "Y": n["location"][1], "Z": n["location"][2],
                 "ë¹„ê³ ": n.get("notes", "")}
                for n in data["npcs"]
            ])
            fig.add_trace(go.Scatter(
                x=df_npc["X"], y=df_npc["Z"], mode="markers+text", name="NPC",
                marker=dict(color="yellow", size=8),
                text=df_npc["ì´ë¦„"].where(df_npc["ì´ë¦„"].isin(selected_npcs), ""),
                textposition="top center",
                customdata=df_npc[["X", "Y", "Z", "ì´ë¦„", "ë¹„ê³ "]],
                hovertemplate="X=%{customdata[0]}<br>Y=%{customdata[1]}<br>Z=%{customdata[2]}<br>"
                              "ì´ë¦„=%{customdata[3]}<br>ë¹„ê³ =%{customdata[4]}"
            ))

        if show_tp:
            df_tp = pd.DataFrame([
                {"ì´ë¦„": tp["name"], "X": tp["location"][0], "Y": tp["location"][1], "Z": tp["location"][2],
                 "ì§€ì—­êµ¬ë¶„": tp["region_type"]}
                for tp in data["teleports"]
            ])
            tp_names = df_tp["ì´ë¦„"].tolist()
            selected_tps = []
            with st.sidebar.expander("í…”ë ˆí¬íŠ¸ ëª©ë¡", expanded=False):
                toggle_tp_names = st.checkbox("í…”ë ˆí¬íŠ¸ ì´ë¦„ ì „ì²´ í‘œì‹œ ON/OFF", value=True, key="toggle_tp_names")
                for i, name in enumerate(tp_names):
                    checked = st.checkbox(f"{name}", key=f"tp_{i}_{name}", value=toggle_tp_names)
                    if checked:
                        selected_tps.append(name)
            fig.add_trace(go.Scatter(
                x=df_tp["X"], y=df_tp["Z"], mode="markers+text", name="í…”ë ˆí¬íŠ¸",
                marker=dict(color="purple", size=8),
                text=df_tp["ì´ë¦„"].where(df_tp["ì´ë¦„"].isin(selected_tps), ""),
                textposition="top center",
                customdata=df_tp[["X", "Y", "Z", "ì´ë¦„", "ì§€ì—­êµ¬ë¶„"]],
                hovertemplate="X=%{customdata[0]}<br>Y=%{customdata[1]}<br>Z=%{customdata[2]}<br>"
                              "ì´ë¦„=%{customdata[3]}<br>ì§€ì—­êµ¬ë¶„=%{customdata[4]}"
            ))

    elif mode == "war":
        war_categories = [
            ("Dungeon Boys", "ë˜ì „ë³´ì´ì¦ˆ", "green"),
            ("Wasobeso", "ì™€ì˜ë² ì˜", "blue"),
            ("Tangled Dahye", "íƒ±ê¸€ë‹¤í˜œ", "brown")
        ]
    
        with st.sidebar.expander("ì „ìŸ ì§€ë„ í‘œì‹œ ì˜µì…˜", expanded=True):
            show_war_names_toggle = st.checkbox("ì´ë¦„ ì „ì²´ í‘œì‹œ ON/OFF", value=True, key="toggle_war_names")

        for data_key, display_name, color in war_categories:
            if data_key in data:
                df = pd.DataFrame([
                    {"ì´ë¦„": item["name"], "X": item["location"][0], "Y": item["location"][1], "Z": item["location"][2]}
                    for item in data[data_key]
                ])
    
                # ì²´í¬ë°•ìŠ¤ UI
                selected_names = []
                with st.sidebar.expander(f"{display_name} ëª©ë¡", expanded=False):
                    for i, name in enumerate(df["ì´ë¦„"]):
                        checked = st.checkbox(f"{name}", key=f"war_{data_key}_{i}", value=show_war_names_toggle)
                        if checked:
                            selected_names.append(name)
    
                # ë§ˆì»¤ í‘œì‹œ
                fig.add_trace(go.Scatter(
                    x=df["X"], y=df["Z"], mode="markers+text", name=display_name,
                    marker=dict(color=color, size=8),
                    text=df["ì´ë¦„"].where(df["ì´ë¦„"].isin(selected_names), ""),
                    textposition="top center",
                    customdata=df[["X", "Y", "Z", "ì´ë¦„"]],
                    hovertemplate="X=%{customdata[0]}<br>Y=%{customdata[1]}<br>"
                                  "Z=%{customdata[2]}<br>ì´ë¦„=%{customdata[3]}"
                ))

  
        df_tp = pd.DataFrame([
            {"ì´ë¦„": tp["name"], "X": tp["location"][0], "Y": tp["location"][1], "Z": tp["location"][2],
             "ì§€ì—­êµ¬ë¶„": tp["region_type"]}
            for tp in data["teleports"]
        ])
        tp_names = df_tp["ì´ë¦„"].tolist()
        selected_tps = []
        with st.sidebar.expander("í…”ë ˆí¬íŠ¸ ëª©ë¡", expanded=False):
            toggle_tp_names = st.checkbox("í…”ë ˆí¬íŠ¸ ì´ë¦„ ì „ì²´ í‘œì‹œ ON/OFF", value=True, key="toggle_war_tp_names")
            for i, name in enumerate(tp_names):
                checked = st.checkbox(f"{name}", key=f"war_tp_{i}", value=toggle_tp_names)
                if checked:
                    selected_tps.append(name)

        fig.add_trace(go.Scatter(
            x=df_tp["X"], y=df_tp["Z"], mode="markers+text", name="í…”ë ˆí¬íŠ¸",
            marker=dict(color="purple", size=8),
            text=df_tp["ì´ë¦„"].where(df_tp["ì´ë¦„"].isin(selected_tps), ""),
            textposition="top center",
            customdata=df_tp[["X", "Y", "Z", "ì´ë¦„", "ì§€ì—­êµ¬ë¶„"]],
            hovertemplate="X=%{customdata[0]}<br>Y=%{customdata[1]}<br>"
                          "Z=%{customdata[2]}<br>ì´ë¦„=%{customdata[3]}<br>ì§€ì—­êµ¬ë¶„=%{customdata[4]}"
        ))

    if not fig.data:
        st.warning("í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
        return

    fig.update_layout(height=700, dragmode="pan")
    st.plotly_chart(fig, use_container_width=True, config={"scrollZoom": True})

# ------------------ Streamlit ------------------
st.set_page_config(layout="wide")
st.sidebar.title("ë©”ë‰´")

tab_option = st.sidebar.radio("íƒ­ ì„ íƒ", ["ê²€ìƒ‰ê¸°ëŠ¥", "ì¹´í…Œê³ ë¦¬", "ì¢Œí‘œ ê²€ìƒ‰", "ê°€ìƒ ì§€ë„", "ì „ìŸì§€ë„"])

# ------------------ ê²€ìƒ‰ íƒ­ ------------------
if tab_option == "ê²€ìƒ‰ê¸°ëŠ¥":
    st.title("ë£¬ì œë¡œ ê²€ìƒ‰ê¸°")

    if "keyword" not in st.session_state:
        st.session_state["keyword"] = ""
    if "search_triggered" not in st.session_state:
        st.session_state["search_triggered"] = False
    if "show_all" not in st.session_state:
        st.session_state["show_all"] = False

    def trigger_search():
        st.session_state["search_triggered"] = True
        st.session_state["show_all"] = False

    def show_all_items():
        st.session_state["keyword"] = ""
        st.session_state["search_triggered"] = False
        st.session_state["show_all"] = True

    col_input, col_button = st.columns([5, 1])
    with col_input:
        st.text_input("ê²€ìƒ‰ì–´", key="keyword", placeholder="ê²€ìƒ‰ì–´ ì…ë ¥ í›„ ì—”í„°", on_change=trigger_search)
    with col_button:
        st.markdown(" ")
        st.markdown(" ")
        st.button("ê²€ìƒ‰", on_click=trigger_search)

    st.button("ëª¨ë“  í•­ëª© ë³´ê¸°", on_click=show_all_items)

    if st.session_state.search_triggered or st.session_state.show_all:
        results = search_data(st.session_state["keyword"], data)
        total = sum(len(results[k]) for k in results)
        st.info(f"ì´ {total}ê°œ ê²°ê³¼")

        for category in ["ë˜ì „", "NPC", "í…”ë ˆí¬íŠ¸"]:
            if results[category]:
                st.subheader(category)
                for item in results[category]:
                    st.markdown(f"### [{item['type']}] {item['name']}")
                    st.write(f"ìœ„ì¹˜: {item['location']}")
                    if item["type"] == "ë˜ì „":
                        st.write(f"ì§€ì—­: {item['region']}")
                        st.write(f"ë³´ìƒ: {item['reward']}")
                        st.write(f"ê°€ì¥ ê°€ê¹Œìš´ í…”ë ˆí¬íŠ¸: {item['nearest_tp']['name']} ({item['nearest_tp']['region_type']}) - {item['dist']}m")
                    elif item["type"] == "NPC":
                        if item.get("notes"):
                            st.write(f"ë¹„ê³ : {item['notes']}")
                        st.write(f"ê°€ì¥ ê°€ê¹Œìš´ í…”ë ˆí¬íŠ¸: {item['nearest_tp']['name']} ({item['nearest_tp']['region_type']}) - {item['dist']}m")
                    elif item["type"] == "í…”ë ˆí¬íŠ¸":
                        st.write(f"ì§€ì—­ êµ¬ë¶„: {item['region_type']}")
                    st.markdown("---")

        st.session_state["search_triggered"] = False

# ------------------ ì¹´í…Œê³ ë¦¬ íƒ­ ------------------
elif tab_option == "ì¹´í…Œê³ ë¦¬":
    st.title("ì¹´í…Œê³ ë¦¬ ë³´ê¸°")
    category = st.radio("ì¹´í…Œê³ ë¦¬ ì„ íƒ", ["ë˜ì „", "ì¬ë£Œ"])

    if category == "ë˜ì „":
        for dungeon in data["dungeons"]:
            with st.expander(dungeon["name"]):
                st.write(f"ìœ„ì¹˜: {dungeon['location']}")
                st.write(f"ì§€ì—­: {dungeon['region']}")
                st.write(f"ë³´ìƒ: {dungeon['reward']}")

    elif category == "ì¬ë£Œ":
        reward_set = set()
        for dungeon in data["dungeons"]:
            for reward in dungeon["reward"].split(","):
                reward = reward.strip()
                if reward and not reward.endswith("G"):
                    reward_set.add(reward)
        for reward in sorted(reward_set):
            with st.expander(reward):
                related = [d for d in data["dungeons"] if reward in d["reward"]]
                for d in related:
                    st.write(f"- {d['name']} @ {d['region']}")

# ------------------ ì¢Œí‘œ ê¸°ë°˜ íƒ­ ------------------
elif tab_option == "ì¢Œí‘œ ê²€ìƒ‰":
    st.title("ì¢Œí‘œ ê¸°ë°˜ í…”ë ˆí¬íŠ¸ ì°¾ê¸°")

    x = st.number_input("X ì¢Œí‘œ", value=0)
    y = st.number_input("Y ì¢Œí‘œ", value=0)
    z = st.number_input("Z ì¢Œí‘œ", value=0)

    if st.button("ê°€ê¹Œìš´ í…”ë ˆí¬íŠ¸ ì°¾ê¸°"):
        location = [x, y, z]
        nearest, dist = get_nearest_teleport(location, data["teleports"])
        st.success(f"ê°€ì¥ ê°€ê¹Œìš´ í…”ë ˆí¬íŠ¸ëŠ” **{nearest['name']}** ({nearest['region_type']}) - {dist}m")

# ------------------ ê°€ìƒ ì§€ë„ íƒ­ ------------------
elif tab_option == "ê°€ìƒ ì§€ë„":
    st.title("ê°€ìƒ ì§€ë„")
    plot_virtual_map_interactive(data)

elif tab_option == "ì „ìŸì§€ë„":
    st.title("ì „ìŸì§€ë„")
    plot_virtual_map_interactive(data, mode="war")

